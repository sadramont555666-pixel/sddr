# ๐ฑ ุฑุงูููุง ฺฉุงูู ฺฉูพุงุฑฺูโุณุงุฒ SMS.ir

## โ ุชุบุฑุงุช ุงูุฌุงู ุดุฏู

ูพุฑูฺู ุจู ุทูุฑ ฺฉุงูู ุงุฒ **Kavenegar** ุจู **SMS.ir** ููุชูู ุดุฏู ุงุณุช.

### ๐ ูุงูโูุง ุจูโุฑูุฒุฑุณุงู ุดุฏู:

1. โ **`src/app/api/utils/sms.js`** - ูุงฺูู ุงุตู SMS
   - ุงุณุชูุงุฏู ุงุฒ SMS.ir Verify API
   - ูพุดุชุจุงู ุงุฒ Template-based sending
   - ููุท ฺฉุฏ OTP ุงุฑุณุงู ูโุดูุฏ (Template ูุชู ุฑุง ูุฏุฑุช ูโฺฉูุฏ)

2. โ **`src/app/api/auth/register/route.js`** - ูุณุฑ ุซุจุชโูุงู
   - ุญุฐู ุณุงุฎุช ูพุงู ุฏุณุช
   - ุงุฑุณุงู ููุท ฺฉุฏ OTP

3. โ **`src/app/api/auth/otp/send/route.js`** - ูุณุฑ ุงุฑุณุงู OTP
   - ุญุฐู ุณุงุฎุช ูพุงู ุฏุณุช
   - ุงุฑุณุงู ููุท ฺฉุฏ OTP

4. โ **`env.example`** - ูพฺฉุฑุจูุฏ ูุญุท
   - ุงูุฒูุฏู ุดุฏู ูุชุบุฑูุง SMS.ir

---

## ๐ ุฑุงูโุงูุฏุงุฒ

### ูุฑุญูู 1: ุฏุฑุงูุช API Key ุงุฒ SMS.ir

1. ูุงุฑุฏ ูพูู SMS.ir ุดูุฏ: **https://www.sms.ir/panel**
2. ุงุฒ ููู: **ุชูุธูุงุช** โ **ฺฉูุฏ API**
3. ฺฉูุฏ API ุฎูุฏ ุฑุง ฺฉูพ ฺฉูุฏ

### ูุฑุญูู 2: ุณุงุฎุช Template

1. ุฏุฑ ูพูู SMS.ir: **ุงูฺฏููุง (Templates)** โ **ุงูฺฏู ุฌุฏุฏ**
2. ูุดุฎุตุงุช Template:

```
ูุงู ุงูฺฏู: signup_otp (ุง ูุฑ ูุงู ุฏฺฏุฑ)
ููุน: ฺฉุฏ ุชุงุฏ

ูุชู ูพุงู:
ฺฉุฏ ุชุงุฏ ุดูุง: #code#
ุงุนุชุจุงุฑ: ฒ ุฏููู
ุณุงูุงูู ูุทุงูุนู - ุฎุงูู ุณูฺฏโุดฺฉู
```

โ๏ธ **ูฺฉุชู ููู:** 
- ูพุงุฑุงูุชุฑ ุจุงุฏ ุฏููุงู `#code#` ูุงูุฏู ุดูุฏ
- ุงู ูุงู ุฏุฑ ฺฉุฏ ูุง ุจู ุตูุฑุช `code` ุงุณุชูุงุฏู ูโุดูุฏ

3. Template ุฑุง ุฐุฎุฑู ฺฉูุฏ ู ููุชุธุฑ ุชุงุฏ ุจูุงูุฏ (ูุนูููุงู ฺูุฏ ุณุงุนุช)

### ูุฑุญูู 3: ุชูุธู ูุชุบุฑูุง ูุญุท

ุฏุฑ ูุงู `.env`:

```env
# SMS Driver (ุงุฌุจุงุฑ)
SMS_DRIVER=smsir

# SMS.ir API Key (ุงุฌุจุงุฑ - ุงุฒ ูพูู SMS.ir)
SMS_API_KEY=your_actual_api_key_here

# ูุงู ุง ID Template (ุงุฌุจุงุฑ - ุงุฒ ูพูู SMS.ir)
SMS_TEMPLATE_NAME=signup_otp

# ุญุงูุช ุชุณุช (ุงุฎุชุงุฑ)
# true = ฺฉุฏ ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดูุฏุ ูพุงูฺฉ ูุงูุน ุงุฑุณุงู ููโุดูุฏ
# false = ูพุงูฺฉ ูุงูุน ุงุฑุณุงู ูโุดูุฏ
TEST_ECHO_OTP=false
SMS_MOCK_MODE=false
```

---

## ๐ ูุชุบุฑูุง ูุญุท

### ุงุฌุจุงุฑ:

| ูุชุบุฑ | ุชูุถุญุงุช | ูุซุงู |
|-------|---------|------|
| `SMS_DRIVER` | ุจุงุฏ `smsir` ุจุงุดุฏ | `smsir` |
| `SMS_API_KEY` | ฺฉูุฏ API ุงุฒ ูพูู SMS.ir | `abc123...` |
| `SMS_TEMPLATE_NAME` | ูุงู ุง ID template | `signup_otp` |

### ุงุฎุชุงุฑ:

| ูุชุบุฑ | ุชูุถุญุงุช | ูพุดโูุฑุถ |
|-------|---------|---------|
| `TEST_ECHO_OTP` | ุญุงูุช ุชุณุช (true/false) | `false` |
| `SMS_MOCK_MODE` | ุญุงูุช Mock ฺฉุงูู | `false` |

---

## ๐งช ุชุณุช

### ุชุณุช ูุญู (ุจุฏูู ุงุฑุณุงู ูุงูุน):

```env
SMS_DRIVER=smsir
TEST_ECHO_OTP=true
```

**ูุชุฌู:**
```bash
[sendSMS][MOCK] to=989123456789 code=123456
```

ฺฉุฏ ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดูุฏ ู ูพุงูฺฉ ูุงูุน ุงุฑุณุงู ููโุดูุฏ.

### ุชุณุช ูุงูุน (ุงุฑุณุงู ุจู SMS.ir):

```env
SMS_DRIVER=smsir
SMS_API_KEY=your_real_api_key
SMS_TEMPLATE_NAME=your_template_name
TEST_ECHO_OTP=false
SMS_MOCK_MODE=false
```

**ูพุดโูุงุฒูุง:**
- โ API Key ูุนุชุจุฑ
- โ Template ุชุงุฏ ุดุฏู
- โ ุงุนุชุจุงุฑ ฺฉุงู ุฏุฑ ุญุณุงุจ SMS.ir

---

## ๐ ุนุจโุงุจ

### ุฎุทุง: "SMS_DRIVER must be set to 'smsir'"

**ุนูุช:** ูุชุบุฑ `SMS_DRIVER` ุชูุธู ูุดุฏู ุง ููุฏุงุฑ ุงุดุชุจุงู ุฏุงุฑุฏ

**ุฑุงูโุญู:**
```env
SMS_DRIVER=smsir
```

### ุฎุทุง: "SMS_API_KEY is required"

**ุนูุช:** ฺฉูุฏ API ุชูุธู ูุดุฏู

**ุฑุงูโุญู:**
```env
SMS_API_KEY=your_actual_api_key_here
```

### ุฎุทุง: "SMS_TEMPLATE_NAME is required"

**ุนูุช:** ูุงู Template ุชูุธู ูุดุฏู

**ุฑุงูโุญู:**
```env
SMS_TEMPLATE_NAME=your_template_name
```

### ุฎุทุง: "Unauthorized" ุง HTTP 401

**ุนูุช:** API Key ูุงูุนุชุจุฑ ุงุณุช

**ุฑุงูโุญู:**
1. ฺฉูุฏ API ุฑุง ุงุฒ ูพูู SMS.ir ูุฌุฏุฏุงู ฺฉูพ ฺฉูุฏ
2. ูุทูุฆู ุดูุฏ ูุงุตูู ุง ฺฉุงุฑุงฺฉุชุฑ ุงุถุงู ูุฏุงุฑุฏ

### ุฎุทุง: "Template not found"

**ุนูุช:** 
- Template ูููุฒ ุชุงุฏ ูุดุฏู
- ูุงู Template ุงุดุชุจุงู ุงุณุช

**ุฑุงูโุญู:**
1. ุฏุฑ ูพูู SMS.ir ุจุฑุฑุณ ฺฉูุฏ Template ุชุงุฏ ุดุฏู ุจุงุดุฏ
2. ูุงู ุฏูู Template ุฑุง ุฏุฑ `.env` ูุฑุงุฑ ุฏูุฏ

---

## ๐ ูุญูู ฺฉุงุฑ API

### ุฏุฑุฎูุงุณุช ุจู SMS.ir:

```javascript
POST https://ws.sms.ir/api/v1/send/verify

Headers:
  Content-Type: application/json
  x-api-key: YOUR_API_KEY

Body:
{
  "Mobile": "989123456789",
  "TemplateId": "signup_otp",
  "Parameters": [
    {
      "Name": "code",
      "Value": "123456"
    }
  ]
}
```

### ูพุงุณุฎ ูููู:

```json
{
  "status": 1,
  "message": "ุนููุงุช ูููู",
  "data": {...}
}
```

### ูพุงุณุฎ ูุงูููู:

```json
{
  "status": 0,
  "message": "ุชูุถุญุงุช ุฎุทุง"
}
```

---

## ๐ ููุงุณู ุจุง Kavenegar

| ูฺฺฏ | Kavenegar | SMS.ir |
|-------|-----------|--------|
| API Method | VerifyLookup | Verify |
| Endpoint | `/verify/lookup.json` | `/send/verify` |
| Authentication | API Key ุฏุฑ URL | Header: `x-api-key` |
| Parameter Name | `token` | `Name: "code"` |
| Success Status | `return.status: 200` | `status: 1` |

---

## โ๏ธ ูฺฉุงุช ููู

### ุจุฑุง Production:

1. โ **ุญุชูุงู** `TEST_ECHO_OTP=false` ฺฉูุฏ
2. โ **ุญุชูุงู** API Key ูุงูุน ุงุณุชูุงุฏู ฺฉูุฏ
3. โ **ุญุชูุงู** Template ุชุงุฏ ุดุฏู ุจุงุดุฏ
4. โ **ุญุชูุงู** ุญุณุงุจ SMS.ir ุฑุง ุดุงุฑฺ ฺฉูุฏ
5. โ **ุญุชูุงู** ูุชุบุฑ `SMS_DRIVER=smsir` ุชูุธู ุดูุฏ

### ุจุฑุง Development:

1. โ ุงุฒ `TEST_ECHO_OTP=true` ุงุณุชูุงุฏู ฺฉูุฏ
2. โ ฺฉุฏ ุฏุฑ console ูโุจูุฏ
3. โ ูุงุฒ ุจู API Key ูุงูุน ูุณุช
4. โ ูุฒููโุง ูุฏุงุฑุฏ

---

## ๐ ูพุดุชุจุงู SMS.ir

- ๐ ูุจโุณุงุช: https://www.sms.ir
- ๐ง ูพูู: https://www.sms.ir/panel
- ๐ ูุณุชูุฏุงุช API: https://www.sms.ir/api
- โ๏ธ ูพุดุชุจุงู: ุงุฒ ุทุฑู ูพูู ฺฉุงุฑุจุฑ

---

## โ ฺฺฉโูุณุช ููุง

ูุจู ุงุฒ ุงุณุชูุฑุงุฑ ุฏุฑ Production:

- [ ] API Key ุงุฒ ูพูู SMS.ir ุฏุฑุงูุช ุดุฏู
- [ ] Template ุจุง ูพุงุฑุงูุชุฑ `#code#` ุณุงุฎุชู ุดุฏู
- [ ] Template ุชุงุฏ ุดุฏู ุงุณุช
- [ ] ุญุณุงุจ SMS.ir ุดุงุฑฺ ุดุฏู
- [ ] ูุชุบุฑ `SMS_DRIVER=smsir` ุชูุธู ุดุฏู
- [ ] ูุชุบุฑ `SMS_API_KEY` ุจุง ฺฉูุฏ ูุงูุน ุชูุธู ุดุฏู
- [ ] ูุชุบุฑ `SMS_TEMPLATE_NAME` ุจุง ูุงู Template ุชูุธู ุดุฏู
- [ ] `TEST_ECHO_OTP=false` ุชูุธู ุดุฏู
- [ ] `SMS_MOCK_MODE=false` ุชูุธู ุดุฏู
- [ ] ุชุณุช ููุง ุงูุฌุงู ุดุฏู

---

## ๐ ูุชุฌู

โ **ฺฉูพุงุฑฺูโุณุงุฒ SMS.ir ฺฉุงูู ุดุฏ!**

ุดูุง ุงฺฉููู ูโุชูุงูุฏ:
1. ุฏุฑ ุญุงูุช ุชุณุช ุจุง `TEST_ECHO_OTP=true` ฺฉุงุฑ ฺฉูุฏ
2. ุจุง ุชูุธู API Key ู Template ูุงูุนุ ูพุงูฺฉ ุงุฑุณุงู ฺฉูุฏ
3. ุงุฒ Templateโูุง ุณูุงุฑุด ุงุณุชูุงุฏู ฺฉูุฏ

**ูููู ุจุงุดุฏ!** ๐

