# ฺฏุฒุงุฑุด ุฑูุน ูุดฺฉู ุงุฑุณุงู ูพุงูฺฉ ุจุง ฺฉุงููโูฺฏุงุฑ

## โ ูุดฺฉูุงุช ุฑูุน ุดุฏู

### 1. **ูพุงุฏูโุณุงุฒ REST API ุจู ุฌุง SDK**
- โ **ูุจู**: ุงุณุชูุงุฏู ุงุฒ ูพฺฉุฌ `kavenegar` ู ูุชุฏ SDK
- โ **ุจุนุฏ**: ุงุณุชูุงุฏู ูุณุชูู ุงุฒ REST API ฺฉุงููโูฺฏุงุฑ
- **ูุฒุงุง**: 
  - ุนุฏู ูุงุจุณุชฺฏ ุจู SDK
  - ูุงฺฏ ฺฉุงูู ุฏุฑุฎูุงุณุช ู ูพุงุณุฎ
  - ฺฉูุชุฑู ุจุดุชุฑ ุฑู ุฎุทุงูุง

### 2. **ุฑูุน ูุดฺฉู ูุชุบุฑูุง ูุญุท**
- โ **ูุจู**: ููุท ุงุฒ `KAVENEGAR_LINE_NUMBER` ุงุณุชูุงุฏู ูโฺฉุฑุฏ
- โ **ุจุนุฏ**: ุงุฒ ููู ูุชุบุฑูุง ุฒุฑ ูพุดุชุจุงู ูโฺฉูุฏ (ุจุง ุงูููุช):
  - `KAVENEGAR_LINE_NUMBER`
  - `KAVENEGAR_SENDER_NUMBER` โญ (ุงุตู ุดูุง)
  - `SMS_SENDER`
  - `KAVENEGAR_SENDER`
  - ูพุดโูุฑุถ: `2000660110`

### 3. **ุจูุจูุฏ ุดูุงุณุง ูพุงุณุฎ ูููู**
- โ ุจุฑุฑุณ `json.return.status === 200`
- โ ูุงฺฏ ูุงุถุญ ุจุฑุง ููููุช ู ุฎุทุง
- โ ููุงุด ูพุงู ุฎุทุง ฺฉุงููโูฺฏุงุฑ ุฏุฑ ฺฉูุณูู

### 4. **ูพุดุชุจุงู ุงุฒ ุญุงูุช ุชุณุช ูุญู**
- โ ูุชุบุฑ `TEST_ECHO_OTP=true`
- โ ุนุฏู ุงุฑุณุงู ูุงูุน ูพุงูฺฉ ุฏุฑ ุญุงูุช ุชุณุช
- โ ูุงฺฏ ฺฉุฏ ุฏุฑ ฺฉูุณูู ุจุฑุง ุชุณุช

### 5. **ุจูุจูุฏ ุชุงุจุน normalizeIranPhone**
- โ ูพุดุชุจุงู ุงุฒ ููู ูุฑูุชโูุง ูุนููู ุงุฑุงู
- โ ุฎุฑูุฌ ฺฉุณุงู: `09xxxxxxxxx`
- โ ุงูุฒูุฏู `0` ุจู ุดูุงุฑูโูุง ฺฉู ุจุง `9` ุดุฑูุน ูโุดููุฏ

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู

### 1. `src/app/api/utils/sms.js` โญ **ุงุตู**
```javascript
// ูุจู: SDK + Twilio
// ุจุนุฏ: REST API ุฎุงูุต ฺฉุงููโูฺฏุงุฑ

export function normalizeIranPhone(raw) { ... }
export async function sendSMS(phone, message, options = {}) { ... }
export async function notifySangshekanOnSignup(userPhoneNumber) { ... }
```

### 2. `env.example`
```env
KAVENEGAR_API_KEY="YOUR_API_KEY_HERE"
KAVENEGAR_SENDER_NUMBER="2000660110"
TEST_ECHO_OTP="false"  # โญ ุฌุฏุฏ
```

### 3. `KAVENEGAR_SETUP_GUIDE.md` โญ **ุฌุฏุฏ**
ุฑุงูููุง ฺฉุงูู ุฑูุน ุฎุทุง 501 ู ุฑุงูโุงูุฏุงุฒ ฺฉุงููโูฺฏุงุฑ

## ๐ด ุนูุช ุฎุทุง Status 501

```json
{
  "return": {
    "status": 501,
    "message": "ุงูฺฉุงู ุงุฑุณุงู ูพุงูฺฉ ููุท ุจู ุดูุงุฑู ุตุงุญุจ ุญุณุงุจ ุฏุงุฏู ุดุฏู ุงุณุช"
  }
}
```

### ุงู ุฎุทุง **ุงุฒ ุทุฑู ฺฉุงููโูฺฏุงุฑ** ุงุณุชุ ูู ฺฉุฏ ุดูุง!

**ุฏูู**: ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุดูุง ุฏุฑ **ุญุงูุช ุชุณุช** ุงุณุช ู ูุญุฏูุฏุช ุฏุงุฑุฏ.

## โ ุฑุงูโุญูโูุง (ุจู ุชุฑุชุจ ุงูููุช)

### ุฑูุด ฑ: ุญุงูุช ุชุณุช ูุญู (ููุฑ - ุจุฏูู ูุฒูู)

ุฏุฑ ูุงู `.env` ุง ุฏุฑ Liara:

```env
TEST_ECHO_OTP=true
```

**ูุชุฌู**:
- โ ุงุฑุณุงู ูุงูุน ุงูุฌุงู ููโุดูุฏ
- โ ฺฉุฏ ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ
- โ ููู ุซุจุชโูุงู ฺฉุงูู ฺฉุงุฑ ูโฺฉูุฏ
- โ ุจุฑุง ุชูุณุนู ู ุชุณุช ููุงุณุจ ุงุณุช

### ุฑูุด ฒ: ุงูุฒูุฏู ุดูุงุฑู ุชุณุช ุจู ูพูู ฺฉุงููโูฺฏุงุฑ (ต ุฏููู)

1. ูุงุฑุฏ ูพูู ุดูุฏ: https://panel.kavenegar.com
2. ููู: **ุชูุธูุงุช โ ุดูุงุฑูโูุง ุชุณุช**
3. ุดูุงุฑู `09928254081` ุฑุง ุงุถุงูู ฺฉูุฏ
4. ุงฺฉููู ูโุชูุงูุฏ ุจู ุงู ุดูุงุฑู ูพุงูฺฉ ุจูุฑุณุชุฏ

### ุฑูุด ณ: ุงุญุฑุงุฒ ููุช ู ูุนุงูโุณุงุฒ ุญุณุงุจ (ฑ-ฒ ุฑูุฒ)

ุจุฑุง ุงุณุชูุงุฏู ุชููุฏ (production):

1. **ุงุญุฑุงุฒ ููุช**:
   - ููู: ุชูุธูุงุช โ ุงุญุฑุงุฒ ููุช
   - ุจุงุฑฺฏุฐุงุฑ ูุฏุงุฑฺฉ ุดูุงุณุง
   - ุงูุชุธุงุฑ ุชุงุฏ (ฑ-ฒ ุฑูุฒ ฺฉุงุฑ)

2. **ุดุงุฑฺ ุญุณุงุจ**:
   - ููู: ุฎุฏูุงุช ูุงู โ ุงูุฒุงุด ุงุนุชุจุงุฑ
   - ุญุฏุงูู ฑฐฐ,ฐฐฐ ุฑุงู

3. **ูุนุงูโุณุงุฒ ุฎุท**:
   - ุฎุท `2000660110` ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูุนุงู ูโุดูุฏ

## ๐งช ุชุณุช ฺฉุฏ

### ุชุณุช ฑ: ุญุงูุช Echo (ุจุฏูู ุงุฑุณุงู ูุงูุน)

```bash
# ุฏุฑ .env
TEST_ECHO_OTP=true

# ุณูพุณ ุฏุฑ ูุฑูุฑฺฏุฑ
# ุซุจุชโูุงู ุจุง ูุฑ ุดูุงุฑูโุง
# ฺฉุฏ ุฏุฑ ฺฉูุณูู ุณุฑูุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ
```

**ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ ุฏุฑ ฺฉูุณูู**:
```
[TEST_ECHO_OTP] sendSMS -> receptor:09xxxxxxxxx message:ฺฉุฏ ุชุงุฏ ุดูุง: 123456
```

### ุชุณุช ฒ: ุงุฑุณุงู ูุงูุน (ูพุณ ุงุฒ ุฑูุน ูุญุฏูุฏุช)

```bash
# ุฏุฑ .env
TEST_ECHO_OTP=false
KAVENEGAR_API_KEY=your-key
KAVENEGAR_SENDER_NUMBER=2000660110

# ุณูพุณ ุซุจุชโูุงู ฺฉูุฏ
```

**ุฎุฑูุฌ ูููู ุฏุฑ ฺฉูุณูู**:
```
Kavenegar send response status: 200 body: {"return":{"status":200,...},"entries":[...]}
โ Kavenegar send successful
```

## ๐ ุจุฑุฑุณ ูุงฺฏโูุง

### โ ูููู
```
Kavenegar send response status: 200 body: {"return":{"status":200},"entries":[...]}
โ Kavenegar send successful
```

### โ ุฎุทุง 501 (ูุญุฏูุฏุช ุญุณุงุจ)
```
Kavenegar send response status: 501 body: {"return":{"status":501,"message":"ุงูฺฉุงู ุงุฑุณุงู ูพุงูฺฉ ููุท ุจู ุดูุงุฑู ุตุงุญุจ ุญุณุงุจ ุฏุงุฏู ุดุฏู ุงุณุช"}}
โ๏ธ Kavenegar returned error: 501 ุงูฺฉุงู ุงุฑุณุงู ูพุงูฺฉ ููุท ุจู ุดูุงุฑู ุตุงุญุจ ุญุณุงุจ ุฏุงุฏู ุดุฏู ุงุณุช
```

### โ ุฎุทุง 412 (sender ูุงูุนุชุจุฑ)
```
Kavenegar send response status: 412 body: {"return":{"status":412,"message":"ุงุฑุณุงู ฺฉููุฏู ูุงูุนุชุจุฑ ุงุณุช"}}
โ๏ธ Kavenegar returned error: 412 ุงุฑุณุงู ฺฉููุฏู ูุงูุนุชุจุฑ ุงุณุช
```

## ๐ฏ ุชูุตูโูุง

### ุจุฑุง ุชูุณุนู ูุญู:
```env
TEST_ECHO_OTP=true
```

### ุจุฑุง ุงุณุชุฌ/ุชุณุช:
```env
TEST_ECHO_OTP=false
KAVENEGAR_API_KEY=your-test-key
# ุดูุงุฑูโูุง ุชุณุช ุฑุง ุฏุฑ ูพูู ุงุถุงูู ฺฉูุฏ
```

### ุจุฑุง ูพุฑูุฏุงฺฉุดู:
```env
TEST_ECHO_OTP=false
KAVENEGAR_API_KEY=your-production-key
KAVENEGAR_SENDER_NUMBER=2000660110
# ุญุณุงุจ ุจุงุฏ ุงุญุฑุงุฒ ููุช ุดุฏู ู ุดุงุฑฺ ุดุฏู ุจุงุดุฏ
```

## ๐ ูพุดุชุจุงู

ุงฺฏุฑ ููฺูุงู ูุดฺฉู ุฏุงุฑุฏ:

1. **ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ**: ฺฉู ูพุงุณุฎ ฺฉุงููโูฺฏุงุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. **ุชูุงุณ ุจุง ฺฉุงููโูฺฏุงุฑ**: ฐฒฑ-นฑฐฐณนฐฐ
3. **ุงุฑุณุงู ุชฺฉุช**: https://panel.kavenegar.com/support

## โ ฺฺฉโูุณุช ููุง

- [ ] ูุงู `.env` ุฏุงุฑุง `KAVENEGAR_API_KEY` ุงุณุช
- [ ] ูุงู `.env` ุฏุงุฑุง `KAVENEGAR_SENDER_NUMBER` ุงุณุช
- [ ] ุจุฑุง ุชุณุช ูุญู: `TEST_ECHO_OTP=true` ุชูุธู ุดุฏู
- [ ] ุจุฑุง ูพุฑูุฏุงฺฉุดู: ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุงุญุฑุงุฒ ููุช ุดุฏู
- [ ] ุจุฑุง ูพุฑูุฏุงฺฉุดู: ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุดุงุฑฺ ุดุฏู
- [ ] ุชุณุช ุซุจุชโูุงู ุงูุฌุงู ุดุฏู ู ฺฉุฏ ุฏุฑุงูุช ุดุฏู

## ๐ ุงููุช

- โ API Key ุฏุฑ URL ุจู ุตูุฑุช encode ุดุฏู ุงุฑุณุงู ูโุดูุฏ
- โ ุฏุฑ ูุงฺฏโูุง API Key ููุงุด ุฏุงุฏู ููโุดูุฏ (ุจุง *** ุฌุงฺฏุฒู ูโุดูุฏ)
- โ ูพุงูโูุง ุจู ุตูุฑุช UTF-8 encode ูโุดููุฏ

---

**ูุชุฌู**: ฺฉุฏ ุดูุง โ **ุตุญุญ** ู **ฺฉุงูู** ุงุณุช. ููุท ุจุงุฏ ฺฉ ุงุฒ ุฑุงูโุญูโูุง ุจุงูุง ุฑุง ุจุฑุง ุฑูุน ูุญุฏูุฏุช ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุงุฌุฑุง ฺฉูุฏ.

