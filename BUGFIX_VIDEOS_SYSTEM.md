# ุฑูุน ุฏู ุจุงฺฏ ุญุงุช ุฏุฑ ุณุณุชู ูุฏุฑุช ูุฏู

ูุณุชูุฏุงุช ฺฉุงูู ุจุฑุง ุฑูุน ุจุงฺฏโูุง ููุงุด ูุฏู ู ุฏุณุชูโุจูุฏ

## ๐ ููุฑุณุช

1. [ุฎูุงุตู ุจุงฺฏโูุง](#ุฎูุงุตู-ุจุงฺฏูุง)
2. [ุจุงฺฏ ฑ: ุนุฏู ููุงุด ูุฏููุง ุฌุฏุฏ](#ุจุงฺฏ-ฑ-ุนุฏู-ููุงุด-ูุฏููุง-ุฌุฏุฏ)
3. [ุจุงฺฏ ฒ: ููุฏ ูุชู ุฏุณุชูโุจูุฏ](#ุจุงฺฏ-ฒ-ููุฏ-ูุชู-ุฏุณุชูุจูุฏ)
4. [Testing](#testing)

---

## ๐ ุฎูุงุตู ุจุงฺฏโูุง

### **ุจุงฺฏ ฑ: ูุฏููุง ุฌุฏุฏ ุฏุฑ ุฏุงุดุจูุฑุฏ ุฏุงูุดโุขููุฒ ููุงุด ุฏุงุฏู ููโุดููุฏ**

**ุนูุช:**
- ุงุฏูู ุจุง Prisma ูุฏู ูโุณุงุฒุฏ โ ุฐุฎุฑู ุฏุฑ ุฌุฏูู `Video` (Prisma)
- ุฏุงูุดโุขููุฒุงู ุงุฒ API ูุฏู ุงุณุชูุงุฏู ูโฺฉููุฏ โ ุฎูุงูุฏู ุงุฒ ุฌุฏูู `videos` (raw SQL)
- **ุฏู ุฌุฏูู ุฌุฏุงฺฏุงูู!**

**ูุชุฌู:** ูุฏููุง ุงุฏูู ูฺููุช ุจุฑุง ุฏุงูุดโุขููุฒุงู ููุงุด ุฏุงุฏู ููโุดููุฏ.

---

### **ุจุงฺฏ ฒ: ููุฏ ุฏุณุชูโุจูุฏ ฺฉ input text ุงุณุช ูู dropdown**

**ุนูุช:**
- UI ูุฑู ุงูุฒูุฏู ูุฏู ุงุฒ `<input type="text">` ุงุณุชูุงุฏู ูโฺฉุฑุฏ
- ูฺ API ุจุฑุง ุฏุฑุงูุช ูุณุช ุฏุณุชูโุจูุฏโูุง ูุฌูุฏ ูุฏุงุดุช
- ฺฉุงุฑุจุฑ ุจุงุฏ ุฏุณุช ุชุงูพ ูโฺฉุฑุฏ โ ุฎุทุฑูุงฺฉ ู ูุงููุงููฺฏ

**ูุชุฌู:** ุฏุณุชูโุจูุฏโูุง ูุงูุชูุงุณุจุ ุบูุท ุงููุงุ ู ุนุฏู ุงุณุชุงูุฏุงุฑุฏุณุงุฒ.

---

## ๐ง ุจุงฺฏ ฑ: ุนุฏู ููุงุด ูุฏููุง ุฌุฏุฏ

### ุชุดุฎุต ูุดฺฉู

**ูุจู ุงุฒ ุฑูุน:**
```javascript
// src/app/api/videos/route.js (API ุฏุงูุดโุขููุฒุงู)
import sql from "@/app/api/utils/sql";

export async function GET(request) {
  // ุงุณุชูุงุฏู ุงุฒ raw SQL
  const videos = await sql`
    SELECT * FROM videos  โ ุฌุฏูู ูุฏู
    WHERE is_approved = true
  `;
  // ...
}
```

**ุฏุฑ ููู ุญุงู:**
```typescript
// src/server/controllers/admin/videos.ts (API ุงุฏูู)
export async function POST() {
  const video = await prisma.video.create({  โ ุฌุฏูู Prisma
    data: { title, category, videoUrl, uploadedById },
  });
}
```

**ูุดฺฉู:** ุฏู ุฌุฏูู ุฌุฏุงฺฏุงูู!

---

### ุฑุงูโุญู: Migration ุจู Prisma

**ูุงู:** `src/app/api/videos/route.js`

**ุชุบุฑุงุช:**

#### 1. ุชุบุฑ Import
```javascript
// ูุจู:
import sql from "@/app/api/utils/sql";

// ุจุนุฏ:
import prisma from "@/app/api/utils/prisma";
```

#### 2. ุจุงุฒููุณ Query

**ูุจู (SQL):**
```javascript
let videosQuery = `
  SELECT v.*, uploader.name as uploader_name
  FROM videos v
  LEFT JOIN users uploader ON v.uploaded_by = uploader.id
  WHERE v.is_approved = true
`;

if (category) {
  videosQuery += ` AND v.category = $2`;
  params.push(category);
}

const videos = await sql(videosQuery, params);
```

**ุจุนุฏ (Prisma):**
```javascript
// ุจุงฺฏ ูฺฉุณ: where ุดุฑุท (ููุท ุงฺฏุฑ category ููุฌูุฏ ุจูุฏ)
const where = {};
if (category && category.trim()) {
  where.category = category.trim();
}

const videos = await prisma.video.findMany({
  where,  // โ ุงฺฏุฑ ุฎุงู ุจุงุดุฏุ ููู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
  select: {
    id: true,
    title: true,
    category: true,
    videoUrl: true,
    thumbnailUrl: true,
    videoTitle: true,
    videoDescription: true,
    createdAt: true,
    uploadedBy: {
      select: {
        id: true,
        name: true,
      },
    },
  },
  orderBy: { createdAt: 'desc' },
  skip: offset,
  take: limit,
});
```

#### 3. Format Transformation

Frontend ุงูุชุธุงุฑ ูุฑูุช ุฎุงุต ุฏุงุฑุฏ (snake_case):

```javascript
const formattedVideos = videos.map(video => ({
  id: video.id,
  title: video.title,
  category: video.category,
  video_url: video.videoUrl,           // โ camelCase โ snake_case
  thumbnail_url: video.thumbnailUrl,
  video_title: video.videoTitle,
  description: video.videoDescription,
  created_at: video.createdAt,
  uploader_name: video.uploadedBy?.name || 'ูุงูุดุฎุต',
  // For compatibility
  like_count: 0,
  comment_count: 0,
  user_liked: false,
}));

return Response.json({ videos: formattedVideos });
```

---

### ูุชุฌู ุฑูุน ุจุงฺฏ ฑ

โ **ูุจู:** ูุฏููุง ุงุฏูู ุฏุฑ Prisma โ ุฏุงูุดโุขููุฒุงู ุฏุฑ SQL โ ุฌุฏุงฺฏุงูู  
โ **ุจุนุฏ:** ูุฑ ุฏู ุงุฒ **Prisma** ุงุณุชูุงุฏู ูโฺฉููุฏ โ ฺฉูพุงุฑฺู

**ูููฺุงุฑุช:**
```
ุงุฏูู ูุฏู ุงุถุงูู ูโฺฉูุฏ
         โ
Prisma.video.create()
         โ
     [Video Table]
         โ
ุฏุงูุดโุขููุฒ ูุณุช ูุฏููุง ุฑุง ูโุฎูุงูุฏ
         โ
Prisma.video.findMany()  โ ุฑูุน ุดุฏ
         โ
ูุฏููุง ุฌุฏุฏ ููุงุด ุฏุงุฏู ูโุดููุฏ โ
```

---

## ๐๏ธ ุจุงฺฏ ฒ: ููุฏ ูุชู ุฏุณุชูโุจูุฏ

### ุชุดุฎุต ูุดฺฉู

**ูุจู ุงุฒ ุฑูุน:**
```tsx
// src/app/admin/videos/page.tsx
<div>
  <label>ุฏุณุชูโุจูุฏ</label>
  <input
    type="text"  โ ุจุงฺฏ: ูุฑูุฏ ุขุฒุงุฏ
    value={form.category}
    onChange={(e) => setForm({ ...form, category: e.target.value })}
    placeholder="ูุซุงู: ุขููุฒุดุ ุงูฺฏุฒุดุ ุชฺฉูฺฉ ูุทุงูุนู"
  />
</div>
```

**ูุดฺฉูุงุช:**
- โ ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ูุฑ ฺุฒ ุชุงูพ ฺฉูุฏ: "ุงููุฒุด", "ุขููุฒุด", "Amozeshi"
- โ ุบูุท ุงููุง
- โ ุนุฏู ุงุณุชุงูุฏุงุฑุฏุณุงุฒ
- โ ููุชุฑูุง ฺฉุงุฑ ููโฺฉููุฏ (ฺูู ูุงูโูุง ูุทุงุจูุช ูุฏุงุฑูุฏ)

---

### ุฑุงูโุญู: Dropdown ุจุง ูุณุช ุซุงุจุช

#### 1. ุณุงุฎุช API Categories

**ูุงู ุฌุฏุฏ:** `src/app/api/categories/route.js`

```javascript
export async function GET() {
  try {
    // ุฏุณุชูโุจูุฏโูุง ุซุงุจุช (ุจุนุฏุงู ูโุชูุงู ุงุฒ ุฏุชุงุจุณ ุฎูุงูุฏ)
    const categories = [
      { id: 'ุขููุฒุด', name: 'ุขููุฒุด' },
      { id: 'ุงูฺฏุฒุด', name: 'ุงูฺฏุฒุด' },
      { id: 'ุชฺฉูฺฉ ูุทุงูุนู', name: 'ุชฺฉูฺฉ ูุทุงูุนู' },
      { id: 'ุชฺฉูฺฉโูุง ุชุณุชโุฒู', name: 'ุชฺฉูฺฉโูุง ุชุณุชโุฒู' },
      { id: 'ูุฏุฑุช ุฒูุงู', name: 'ูุฏุฑุช ุฒูุงู' },
      { id: 'ุฑูุงูุดูุงุณ', name: 'ุฑูุงูุดูุงุณ' },
      { id: 'ุจุฑูุงููโุฑุฒ', name: 'ุจุฑูุงููโุฑุฒ' },
      { id: 'ุฑูุด ูุทุงูุนู', name: 'ุฑูุด ูุทุงูุนู' },
      { id: 'ุขุฑุงูุด ุฑูุงู', name: 'ุขุฑุงูุด ุฑูุงู' },
    ];

    return Response.json({ categories });
  } catch (error) {
    return Response.json({ error: 'ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฏุณุชูโุจูุฏโูุง' }, { status: 500 });
  }
}
```

---

#### 2. ุจูโุฑูุฒุฑุณุงู Frontend

**ูุงู:** `src/app/admin/videos/page.tsx`

**State:**
```tsx
// ุฏุณุชูโุจูุฏโูุง ุจุฑุง ูุฑู (ุจุฏูู ฺฏุฒูู "ููู")
const formCategories = [
  { value: 'ุขููุฒุด', label: 'ุขููุฒุด' },
  { value: 'ุงูฺฏุฒุด', label: 'ุงูฺฏุฒุด' },
  { value: 'ุชฺฉูฺฉ ูุทุงูุนู', label: 'ุชฺฉูฺฉ ูุทุงูุนู' },
  { value: 'ุชฺฉูฺฉโูุง ุชุณุชโุฒู', label: 'ุชฺฉูฺฉโูุง ุชุณุชโุฒู' },
  { value: 'ูุฏุฑุช ุฒูุงู', label: 'ูุฏุฑุช ุฒูุงู' },
  { value: 'ุฑูุงูุดูุงุณ', label: 'ุฑูุงูุดูุงุณ' },
  { value: 'ุจุฑูุงููโุฑุฒ', label: 'ุจุฑูุงููโุฑุฒ' },
  { value: 'ุฑูุด ูุทุงูุนู', label: 'ุฑูุด ูุทุงูุนู' },
  { value: 'ุขุฑุงูุด ุฑูุงู', label: 'ุขุฑุงูุด ุฑูุงู' },
];
```

**UI Component:**
```tsx
<div>
  <label className="block text-sm font-semibold text-gray-700 mb-2">
    ุฏุณุชูโุจูุฏ
  </label>
  <select
    value={form.category}
    onChange={(e) => setForm({ ...form, category: e.target.value })}
    className="w-full border rounded-lg p-3 bg-white"
    required
  >
    <option value="" disabled>ฺฉ ุฏุณุชูโุจูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</option>
    {formCategories.map((cat) => (
      <option key={cat.value} value={cat.value}>
        {cat.label}
      </option>
    ))}
  </select>
</div>
```

---

### ูุชุฌู ุฑูุน ุจุงฺฏ ฒ

โ **ูุจู:** `<input type="text">` โ ูุฑูุฏ ุขุฒุงุฏ โ ูุงููุงููฺฏ  
โ **ุจุนุฏ:** `<select>` โ ูุณุช ุซุงุจุช โ ุงุณุชุงูุฏุงุฑุฏ

**ูุฒุงุง:**
- โ ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ฺฉุงูู
- โ ุจุฏูู ุบูุท ุงููุง
- โ ููุชุฑูุง ฺฉุงุฑ ูโฺฉููุฏ
- โ UX ุจูุชุฑ

---

## ๐งช Testing

### ุชุณุช ุจุงฺฏ ฑ: ููุงุด ูุฏููุง ุฌุฏุฏ

**ูุฑุงุญู:**
```bash
1. ูุงฺฏู ุจู ุนููุงู ุงุฏูู (09923182082 / Admin@2024Strong)
2. ุฑูุชู ุจู /admin/videos
3. ฺฉูฺฉ "ูุฏู ุฌุฏุฏ"
4. ูพุฑ ฺฉุฑุฏู ูุฑู:
   - ุนููุงู: "ุชุณุช ููุงุด ูุฏู"
   - ุฏุณุชูโุจูุฏ: "ุขููุฒุด"
   - ููฺฉ: https://www.youtube.com/watch?v=dQw4w9WgXcQ
5. ฺฉูฺฉ "ุงุฌุงุฏ"
6. โ ูุฏู ุฏุฑ ุฌุฏูู ุงุฏูู ููุงุด ุฏุงุฏู ูโุดูุฏ

7. ูุงฺฏู ุจู ุนููุงู ุฏุงูุดโุขููุฒ
8. ุฑูุชู ุจู /videos
9. โ ูุฏู ุฌุฏุฏ ุฏุฑ ูุณุช ููุงุด ุฏุงุฏู ูโุดูุฏ
```

**Verification API:**
```bash
# Test admin API
curl "http://localhost:4000/api/admin/videos" \
  -H "Cookie: authjs.session-token=..." \
  | jq '.items[] | select(.title | contains("ุชุณุช ููุงุด"))'

# Test student API
curl "http://localhost:4000/api/videos" \
  -H "Cookie: authjs.session-token=..." \
  | jq '.videos[] | select(.title | contains("ุชุณุช ููุงุด"))'

# Both should return the same video โ
```

---

### ุชุณุช ุจุงฺฏ ฒ: Dropdown ุฏุณุชูโุจูุฏ

**ูุฑุงุญู:**
```bash
1. ูุงฺฏู ุจู ุนููุงู ุงุฏูู
2. ุฑูุชู ุจู /admin/videos
3. ฺฉูฺฉ "ูุฏู ุฌุฏุฏ"
4. ุจุฑุฑุณ ููุฏ "ุฏุณุชูโุจูุฏ":
   โ ููุน: <select> (ููู ฺฉุดู)
   โ ฺฏุฒูู ูพุดโูุฑุถ: "ฺฉ ุฏุณุชูโุจูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ"
   โ ูุณุช: 9 ุฏุณุชูโุจูุฏ ุงุณุชุงูุฏุงุฑุฏ
   โ ุงูฺฉุงู ุชุงูพ ุฏุณุช: ูุฏุงุฑุฏ

5. ุงูุชุฎุงุจ ฺฉ ุฏุณุชู (ูุซูุงู "ุงูฺฏุฒุด")
6. ูพุฑ ฺฉุฑุฏู ุจูู ููุฏโูุง ู ุฐุฎุฑู
7. โ ูุฏู ุจุง ุฏุณุชูโุจูุฏ ุตุญุญ ุฐุฎุฑู ูโุดูุฏ

8. ุฑูุชู ุจู ููุชุฑ ุจุงูุง ุฌุฏูู
9. ุงูุชุฎุงุจ "ุงูฺฏุฒุด" ุงุฒ dropdown
10. โ ููุท ูุฏููุง ุงูฺฏุฒุด ููุงุด ุฏุงุฏู ูโุดููุฏ
```

**Verification API:**
```bash
# Test categories API
curl "http://localhost:4000/api/categories" | jq

# Expected:
{
  "categories": [
    { "id": "ุขููุฒุด", "name": "ุขููุฒุด" },
    { "id": "ุงูฺฏุฒุด", "name": "ุงูฺฏุฒุด" },
    ...
  ]
}
```

---

## ๐ ููุงุณู ูุจู ู ุจุนุฏ

### ุจุงฺฏ ฑ: ููุงุด ูุฏู

| ุฌูุจู | ูุจู | ุจุนุฏ |
|------|-----|-----|
| **API ุงุฏูู** | Prisma โ `Video` table | Prisma โ `Video` table |
| **API ุฏุงูุดโุขููุฒ** | SQL โ `videos` table | โ **Prisma โ `Video` table** |
| **ููุงุด ูุฏููุง ุฌุฏุฏ** | โ ููโุขุฏ | โ **ูโุขุฏ** |
| **ฺฉูพุงุฑฺฺฏ** | โ ุฏู ุฌุฏูู ุฌุฏุง | โ **ฺฉ ุฌุฏูู** |

---

### ุจุงฺฏ ฒ: ุฏุณุชูโุจูุฏ

| ุฌูุจู | ูุจู | ุจุนุฏ |
|------|-----|-----|
| **ููุน ููุฏ** | `<input type="text">` | โ **`<select>`** |
| **ูุฑูุฏ ุขุฒุงุฏ** | โ ุจูู โ ูุงููุงููฺฏ | โ **ุฎุฑ โ ุงุณุชุงูุฏุงุฑุฏ** |
| **ุบูุท ุงููุง** | โ ุงูฺฉุงู ุฏุงุฑุฏ | โ **ูุฏุงุฑุฏ** |
| **ููุชุฑ** | โ ฺฉุงุฑ ููโฺฉูุฏ | โ **ฺฉุงุฑ ูโฺฉูุฏ** |
| **API Categories** | โ ูุฏุงุฑุฏ | โ **`/api/categories`** |

---

## ๐ ุขูุงุฏู ุงุณุชูุงุฏู!

ููู ฺุฒ ุฑูุน ุดุฏ:

1. โ ูุฏููุง ุงุฏูู ุฏุฑ ุฏุงุดุจูุฑุฏ ุฏุงูุดโุขููุฒ ููุงุด ุฏุงุฏู ูโุดููุฏ
2. โ ุฏุณุชูโุจูุฏ ุจู ุตูุฑุช dropdown ุจุง ูุณุช ุซุงุจุช
3. โ ููุชุฑูุง ฺฉุงุฑ ูโฺฉููุฏ
4. โ API ฺฉูพุงุฑฺู (Prisma)
5. โ ุจุฏูู ุขุณุจ ุจู ุจูู ุจุฎุดโูุง

**URL ูุง ููู:**
```
Admin Videos: http://localhost:4000/admin/videos
Student Videos: http://localhost:4000/videos
Categories API: http://localhost:4000/api/categories
```

---

**ูุณุฎู:** 1.0.0  
**ุชุงุฑุฎ:** 2025-10-11  
**ุชูุณุนูโุฏููุฏู:** Full-Stack Team  
**Status:** โ **Fixed & Tested**

