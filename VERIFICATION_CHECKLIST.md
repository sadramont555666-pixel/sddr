# โ ฺฺฉโูุณุช ุชุงุฏ ุฑูุน ูุดฺฉู SMS

## ๐ ุจุฑุฑุณ ูุงูโูุง ุชุบุฑ ุงูุชู

### โ `src/app/api/utils/sms.js`
- [x] ูพุงุฏูโุณุงุฒ REST API ุจู ุฌุง SDK
- [x] ูพุดุชุจุงู ุงุฒ ููู ูุชุบุฑูุง ูุญุท
- [x] `normalizeIranPhone` ุงุตูุงุญ ุดุฏ
- [x] `sendSMS` ุจุง retry ู backoff
- [x] ูพุดุชุจุงู ุงุฒ `TEST_ECHO_OTP`
- [x] ูุงฺฏ ฺฉุงูู ุฏุฑุฎูุงุณุช ู ูพุงุณุฎ
- [x] `notifySangshekanOnSignup` ุญูุธ ุดุฏ

### โ `env.example`
- [x] `TEST_ECHO_OTP` ุงุถุงูู ุดุฏ
- [x] `KAVENEGAR_SENDER_NUMBER` ููุฌูุฏ ุงุณุช

### โ ูุณุชูุฏุงุช ุฌุฏุฏ
- [x] `KAVENEGAR_SETUP_GUIDE.md` - ุฑุงูููุง ุฑูุน ุฎุทุง
- [x] `SMS_FIX_SUMMARY.md` - ฺฏุฒุงุฑุด ฺฉุงูู ุชุบุฑุงุช

## ๐งช ุชุณุชโูุง ุงูุฌุงู ุดุฏู

### โ ุชุณุช ฑ: TEST_ECHO_OTP
```bash
TEST_ECHO_OTP=true
```
- [x] ฺฉุฏ ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ
- [x] `sendSMS` ููุฏุงุฑ `true` ุจุฑูโฺฏุฑุฏุงูุฏ
- [x] API ฺฉุงููโูฺฏุงุฑ ุตุฏุง ุฒุฏู ููโุดูุฏ

### โ ุชุณุช ฒ: normalizeIranPhone
```javascript
'+989928254081'   โ '09928254081' โ
'00989928254081'  โ '09928254081' โ
'989928254081'    โ '09928254081' โ
'09928254081'     โ '09928254081' โ
'9928254081'      โ '09928254081' โ
```

### โ ุชุณุช ณ: ุงุฑุณุงู ูุงูุน ุจู ฺฉุงููโูฺฏุงุฑ
- [x] ุงุชุตุงู ุจู API ฺฉุงููโูฺฏุงุฑ ุจุฑูุฑุงุฑ ูโุดูุฏ
- [x] sender ุงุฒ env ุฎูุงูุฏู ูโุดูุฏ
- [x] ูพุงุณุฎ ฺฉุงููโูฺฏุงุฑ ูุงฺฏ ูโุดูุฏ
- [x] ุฎุทุง 501 ุจู ุฏุฑุณุช ุดูุงุณุง ู ฺฏุฒุงุฑุด ูโุดูุฏ

## ๐ ุณุงุฒฺฏุงุฑ ุจุง ฺฉุฏูุง ููุฌูุฏ

### โ `src/app/api/auth/register/route.js`
```javascript
const sent = await sendSMS(normalizedPhone, message, { retries: 2 });
if (!sent) throw new Error('...');
```
- [x] ุณุงุฒฺฏุงุฑ - `true/false` ุจุฑูโฺฏุฑุฏุงูุฏ

### โ `src/app/api/auth/otp/send/route.js`
```javascript
const sent = await sendSMS(normalizedPhone, message, { retries: 2 });
if (!sent) throw new Error('...');
```
- [x] ุณุงุฒฺฏุงุฑ - `true/false` ุจุฑูโฺฏุฑุฏุงูุฏ

### โ `src/app/api/auth/otp/verify/route.js`
```javascript
await sendSMS(adminMsisdn, advisorMessage, { retries: 2 });
```
- [x] ุณุงุฒฺฏุงุฑ - ูุชุฌู ุจุฑุฑุณ ููโุดูุฏ

### โ `src/app/api/utils/sms.js` (notifySangshekanOnSignup)
```javascript
const ok = await sendSMS(adminMsisdn, message, { retries: 2 });
if (ok) { ... }
```
- [x] ุณุงุฒฺฏุงุฑ - `true/false` ุจุฑูโฺฏุฑุฏุงูุฏ

## ๐ ุจุฑุฑุณ Linter

```bash
โ No linter errors found
```
- [x] `src/app/api/utils/sms.js`
- [x] `env.example`

## ๐ฏ ูุชุฌู ููุง

### โ ฺฉุฏ ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ
- ฺฉุฏ ุดูุง **ุตุญุญ** ุงุณุช
- ูพุงุฏูโุณุงุฒ **ฺฉุงูู** ุงุณุช
- ููู routeโูุง **ุณุงุฒฺฏุงุฑ** ูุณุชูุฏ

### โ๏ธ ูุญุฏูุฏุช ุงุฒ ุณูุช ฺฉุงููโูฺฏุงุฑ
ุฎุทุง Status 501 ุงุฒ **ุณูุช ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ** ุงุณุช:
```
"ุงูฺฉุงู ุงุฑุณุงู ูพุงูฺฉ ููุท ุจู ุดูุงุฑู ุตุงุญุจ ุญุณุงุจ ุฏุงุฏู ุดุฏู ุงุณุช"
```

### ๐ง ุฑุงูโุญู ููุฑ
ุฏุฑ `.env` ุชูุธู ฺฉูุฏ:
```env
TEST_ECHO_OTP=true
```

ุงู ุจุงุนุซ ูโุดูุฏ:
- โ ฺฉุฏ ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ุดูุฏ
- โ ููู ุซุจุชโูุงู ฺฉุงูู ฺฉุงุฑ ฺฉูุฏ
- โ ุฏุชุงุจุณ ุจู ุฏุฑุณุช ุจูโุฑูุฒ ุดูุฏ
- โ ูฺ ุฎุทุง ุฑุฎ ูุฏูุฏ

### ๐ ุจุฑุง ุงุณุชูุงุฏู ูุงูุน
ฺฉ ุงุฒ ุงู ฺฉุงุฑูุง ุฑุง ุงูุฌุงู ุฏูุฏ:
1. ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุฑุง ุงุญุฑุงุฒ ููุช ฺฉูุฏ (ฑ-ฒ ุฑูุฒ)
2. ุดูุงุฑู ุชุณุช ุฑุง ุฏุฑ ูพูู ุงุถุงูู ฺฉูุฏ (ต ุฏููู)
3. ุจุง ุชู ฺฉุงููโูฺฏุงุฑ ุชูุงุณ ุจฺฏุฑุฏ: ฐฒฑ-นฑฐฐณนฐฐ

## ๐ ูุฑุงุญู ุจุนุฏ ูพุดููุงุฏ

1. โ **ุฏุฑ ุญุงู ุญุงุถุฑ**: ุงุฒ `TEST_ECHO_OTP=true` ุงุณุชูุงุฏู ฺฉูุฏ
2. ๐ **ุงูุฑูุฒ**: ุจุง ฺฉุงููโูฺฏุงุฑ ุชูุงุณ ุจฺฏุฑุฏ ู ุดูุงุฑู ุชุณุช ุงุถุงูู ฺฉูุฏ
3. ๐ **ุงู ููุชู**: ูุฏุงุฑฺฉ ุงุญุฑุงุฒ ููุช ุฑุง ุงุฑุณุงู ฺฉูุฏ
4. ๐ณ **ูพุณ ุงุฒ ุชุงุฏ**: ุญุณุงุจ ุฑุง ุดุงุฑฺ ฺฉูุฏ
5. ๐ **ููุง**: `TEST_ECHO_OTP=false` ฺฉูุฏ ู ุงุณุชูุงุฏู ูุงูุน ุฑุง ุดุฑูุน ฺฉูุฏ

---

**โ ููู ฺุฒ ุขูุงุฏู ุงุณุช. ฺฉุฏ ุดูุง ูุดฺฉู ูุฏุงุฑุฏ!**

