# راهنمای رفع خطای 501 کاوه‌نگار

## مشکل
هنگام ارسال پیامک، خطای زیر دریافت می‌شود:
```
Status: 501
Message: امکان ارسال پیامک فقط به شماره صاحب حساب داده شده است
```

## علت
حساب کاوه‌نگار شما در **حالت تست** قرار دارد و فقط می‌تواند به شماره‌های ثبت‌شده در پنل ارسال کند.

## راه‌حل‌ها

### گزینه ۱: فعال‌سازی حساب کاوه‌نگار (توصیه می‌شود برای پروداکشن)

1. **وارد پنل کاوه‌نگار شوید**: https://panel.kavenegar.com
2. **احراز هویت حساب**:
   - منو: تنظیمات → احراز هویت
   - مدارک هویتی خود را بارگذاری کنید
   - منتظر تایید بمانید (معمولاً ۱-۲ روز کاری)
3. **شارژ حساب**:
   - منو: خدمات مالی → افزایش اعتبار
   - حداقل ۱۰۰,۰۰۰ ریال شارژ کنید
4. **فعال‌سازی خط ارسال**:
   - منو: خدمات پیامکی → خطوط ارسال
   - یک خط عمومی یا اختصاصی فعال کنید

### گزینه ۲: افزودن شماره‌های تست به پنل

اگر فقط برای تست نیاز دارید:

1. وارد پنل شوید
2. منو: تنظیمات → شماره‌های تست
3. شماره‌هایی که می‌خواهید در حالت تست دریافت کننده باشند را اضافه کنید
4. این شماره‌ها می‌توانند پیامک دریافت کنند حتی بدون احراز هویت

### گزینه ۳: استفاده از حالت شبیه‌ساز (برای توسعه محلی)

برای تست محلی بدون ارسال واقعی پیامک:

1. در فایل `.env` این خط را اضافه کنید:
   ```
   TEST_ECHO_OTP=true
   ```
2. اکنون کدهای OTP در کنسول چاپ می‌شوند و پیامک واقعی ارسال نمی‌شود
3. برای پروداکشن، این متغیر را `false` کنید یا حذف کنید

## تست ارسال پیامک

پس از انجام یکی از راه‌حل‌های بالا، با این دستور تست کنید:

```bash
cd create/apps/web
node test-kavenegar-direct.js
```

### خروجی موفق باید این باشد:
```json
{
  "return": {
    "status": 200,
    "message": "..."
  },
  "entries": [...]
}
```

## متغیرهای محیطی مورد نیاز

در فایل `.env`:

```env
KAVENEGAR_API_KEY="your-api-key-from-panel"
KAVENEGAR_SENDER_NUMBER="2000660110"
TEST_ECHO_OTP="false"
```

## نکات مهم

- ✅ خط ارسال `2000660110` یک خط عمومی است که پس از احراز هویت فعال می‌شود
- ✅ برای خطوط اختصاصی (10 رقمی مثل `50002710066110`) باید درخواست جداگانه بدهید
- ✅ در حالت تست، فقط می‌توانید به شماره صاحب حساب ارسال کنید
- ✅ برای تست محلی از `TEST_ECHO_OTP=true` استفاده کنید تا هزینه نداشته باشید

## پشتیبانی کاوه‌نگار

- 📞 تلفن: ۰۲۱-۹۱۰۰۳۹۰۰
- 🌐 وب‌سایت: https://kavenegar.com
- 📧 ایمیل: support@kavenegar.com

