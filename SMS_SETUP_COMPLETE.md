# ๐ฑ ุฑุงูููุง ฺฉุงูู ุชูุธู SMS ุจุง VerifyLookup

## โ ุชุบุฑุงุช ุงูุฌุงู ุดุฏู

### 1๏ธโฃ **ูุงู `src/app/api/utils/sms.js`**
- โ ุงุณุชูุงุฏู ุงุฒ **VerifyLookup API** (ุฑูุด ุงุณุชุงูุฏุงุฑุฏ ฺฉุงููโูฺฏุงุฑ ุจุฑุง OTP)
- โ ููุท **token** (ฺฉุฏ 6 ุฑูู) ุงุฑุณุงู ูโุดูุฏ
- โ **3 ุญุงูุช** ูพุดุชุจุงู ูโุดูุฏ:
  - `TEST_ECHO_OTP=true` โ ฺฉุฏ ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดูุฏ
  - `SMS_MOCK_MODE=true` โ ุญุงูุช Mock ฺฉุงูู
  - `SMS_FALLBACK_TO_ECHO=true` โ ุงฺฏุฑ ุฎุทุง 501 ุงุฒ ฺฉุงููโูฺฏุงุฑ ุขูุฏุ ุจู Echo ุจุฑูโฺฏุฑุฏุฏ

### 2๏ธโฃ **ูุงูโูุง Route**
- โ `auth/otp/send/route.js` - ุจูโุฑูุฒุฑุณุงู ุดุฏ
- โ `auth/register/route.js` - ุจูโุฑูุฒุฑุณุงู ุดุฏ
- โ ุฏุฑ ุญุงูุช ุชุณุช/fallbackุ `debugCode` ุฏุฑ ูพุงุณุฎ ุจุฑูโฺฏุฑุฏุฏ

### 3๏ธโฃ **ูุชุบุฑูุง ูุญุท ุฌุฏุฏ**
```env
TEST_ECHO_OTP="false"
SMS_MOCK_MODE="false"
SMS_FALLBACK_TO_ECHO="false"
```

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ุชูุณุนู ูุญู (ุจุฏูู ุงุฑุณุงู ูุงูุน):

ุฏุฑ ูุงู `.env`:
```env
TEST_ECHO_OTP=true
SMS_MOCK_MODE=true
SMS_FALLBACK_TO_ECHO=true
```

**ูุชุฌู:**
```javascript
// ุฏุฑ console ุณุฑูุฑ:
[sendSMS][ECHO] to=989123456789 token=123456

// ุฏุฑ ูพุงุณุฎ API:
{
  "message": "ฺฉุฏ ุชุงุฏ ุงุฑุณุงู ุดุฏ (ุฏุฑ ุญุงูุช ุชุณุช)",
  "phone": "989123456789",
  "expiresIn": 120,
  "debugCode": "123456"  // โ ฺฉุฏ ุจุฑุง ุชุณุช
}
```

### ุจุฑุง Liara (ุชุณุช ูููุช):

ุฏุฑ **Environment Variables** ุฏุฑ ูพูู Liara:
```
TEST_ECHO_OTP=true
SMS_FALLBACK_TO_ECHO=true
```

**ูุฒุงุง:**
- โ ฺฉุฏ ุฏุฑ ูุงฺฏโูุง Liara ููุงุด ุฏุงุฏู ูโุดูุฏ
- โ ฺฉุฏ ุฏุฑ ูพุงุณุฎ API (`debugCode`) ุจุฑูโฺฏุฑุฏุฏ
- โ ูโุชูุงูุฏ ุจุฏูู KYC ฺฉุงููโูฺฏุงุฑ ุชุณุช ฺฉูุฏ
- โ ุงฺฏุฑ ุฎุทุง 501 ุงุฒ ฺฉุงููโูฺฏุงุฑ ุขูุฏุ ุจู Echo ุจุฑูโฺฏุฑุฏุฏ

### ุจุฑุง Production (ุงุฑุณุงู ูุงูุน):

```env
TEST_ECHO_OTP=false
SMS_MOCK_MODE=false
SMS_FALLBACK_TO_ECHO=false
KAVENEGAR_API_KEY="your-real-api-key"
```

**ูพุดโูุงุฒูุง:**
1. โ ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุงุญุฑุงุฒ ููุช ุดุฏู (KYC)
2. โ Template ุจุง ูุงู `signup` ุฏุฑ ูพูู ฺฉุงููโูฺฏุงุฑ ุณุงุฎุชู ู ุชุงุฏ ุดุฏู
3. โ API Key ูุนุชุจุฑ

---

## ๐จ ุณุงุฎุช Template ุฏุฑ ฺฉุงููโูฺฏุงุฑ

### ูุฑุญูู 1: ูุฑูุฏ ุจู ูพูู
https://panel.kavenegar.com โ **ุงูฺฏููุง (Templates)** โ **ุงูฺฏู ุฌุฏุฏ**

### ูุฑุญูู 2: ูุดุฎุตุงุช Template
```
ูุงู ุงูฺฏู: signup
ููุน: ฺฉุฏ ุชุงุฏ (Verification Code)

ูุชู ูพุงู:
ฺฉุฏ ุชุงุฏ ุดูุง: %token%
ุงุนุชุจุงุฑ: ฒ ุฏููู
ุณุงูุงูู ูุทุงูุนู - ุฎุงูู ุณูฺฏโุดฺฉู
```

โ๏ธ **ูฺฉุชู ููู:** `%token%` ุฌุงฺฏุฒู ูโุดูุฏ ุจุง ฺฉุฏ OTP ุงุฑุณุงู

### ูุฑุญูู 3: ุงุฑุณุงู ุจุฑุง ุชุงุฏ
ูุนูููุงู ฺูุฏ ุณุงุนุช ุชุง 1 ุฑูุฒ ฺฉุงุฑ ุทูู ูโฺฉุดุฏ

---

## ๐ ุจุฑุฑุณ ุฎุทุงูุง

### ุฎุทุง 501: "ุงูฺฉุงู ุงุฑุณุงู ูพุงูฺฉ ููุท ุจู ุดูุงุฑู ุตุงุญุจ ุญุณุงุจ"

**ุนูุช:** ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุดูุง ูุญุฏูุฏ ุงุณุช (ูุงุฒ ุจู KYC)

**ุฑุงูโุญู ูููุช (ุจุฑุง ุชุณุช):**
```env
SMS_FALLBACK_TO_ECHO=true
```

**ุฑุงูโุญู ุฏุงุฆู:**
1. ุงุญุฑุงุฒ ููุช ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ
2. ุดุงุฑฺ ุญุณุงุจ
3. ุงุณุชูุงุฏู ุงุฒ API Key ูุนุชุจุฑ

### ุฎุทุง 422: "Template not found"

**ุนูุช:** Template ุจุง ูุงู `signup` ุฏุฑ ูพูู ุณุงุฎุชู ูุดุฏู ุง ุชุงุฏ ูุดุฏู

**ุฑุงูโุญู:**
1. ูุงุฑุฏ ูพูู ฺฉุงููโูฺฏุงุฑ ุดูุฏ
2. Template ุฑุง ุจุณุงุฒุฏ (ูุฑุงุญู ุจุงูุง)
3. ููุชุธุฑ ุชุงุฏ ุจูุงูุฏ

---

## ๐งช ุชุณุช

### ุชุณุช 1: ุญุงูุช ECHO (ุจุฏูู ุงุฑุณุงู ูุงูุน)

```env
TEST_ECHO_OTP=true
```

**ุฏุฑุฎูุงุณุช:**
```bash
POST /api/auth/register
{
  "phone": "09123456789"
}
```

**ูพุงุณุฎ:**
```json
{
  "message": "ฺฉุฏ ุชุงุฏ ุงุฑุณุงู ุดุฏ (ุฏุฑ ุญุงูุช ุชุณุช)",
  "phone": "989123456789",
  "expiresIn": 120,
  "debugCode": "123456"
}
```

**ูุงฺฏ ุณุฑูุฑ:**
```
[sendSMS][ECHO] to=989123456789 token=123456
```

### ุชุณุช 2: ุญุงูุช Fallback (ุฎุทุง 501)

```env
SMS_FALLBACK_TO_ECHO=true
KAVENEGAR_API_KEY="your-limited-api-key"
```

**ูุชุฌู:**
- ุงูู ุณุน ูโฺฉูุฏ ูุงูุน ุงุฑุณุงู ฺฉูุฏ
- ุงฺฏุฑ ุฎุทุง 501 ุขูุฏุ ุจู Echo ุจุฑูโฺฏุฑุฏุฏ
- ฺฉุฏ ุฏุฑ ูพุงุณุฎ (`debugCode`) ู ูุงฺฏ ููุงุด ุฏุงุฏู ูโุดูุฏ

### ุชุณุช 3: ุญุงูุช Production (ุงุฑุณุงู ูุงูุน)

```env
TEST_ECHO_OTP=false
SMS_MOCK_MODE=false
SMS_FALLBACK_TO_ECHO=false
KAVENEGAR_API_KEY="your-verified-api-key"
```

**ูุชุฌู:**
- ูพุงูฺฉ ูุงูุน ุงุฑุณุงู ูโุดูุฏ
- `debugCode` ุฏุฑ ูพุงุณุฎ ูุณุช
- ฺฉุฏ ููุท ุฏุฑ SMS ุฏุฑุงูุช ูโุดูุฏ

---

## ๐ ุฌุฏูู ุญุงูุชโูุง

| ูุชุบุฑ | Development | Staging | Production |
|-------|------------|---------|------------|
| `TEST_ECHO_OTP` | `true` | `true` | `false` |
| `SMS_MOCK_MODE` | `true` | `false` | `false` |
| `SMS_FALLBACK_TO_ECHO` | `true` | `true` | `false` |
| ูุชุฌู | ฺฉุฏ ุฏุฑ console + API | Fallback ุฏุฑ ุตูุฑุช ุฎุทุง | ุงุฑุณุงู ูุงูุน |

---

## โ๏ธ ูฺฉุงุช ููู

### ๐ด ุจุฑุง Production:
1. **ุญุชูุงู** `TEST_ECHO_OTP=false` ฺฉูุฏ
2. **ุญุชูุงู** `SMS_FALLBACK_TO_ECHO=false` ฺฉูุฏ
3. **ุญุชูุงู** ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุฑุง ุงุญุฑุงุฒ ููุช ฺฉูุฏ
4. **ุญุชูุงู** Template ุฑุง ุฏุฑ ูพูู ุจุณุงุฒุฏ

### ๐ข ุจุฑุง Development:
1. ุงุฒ `TEST_ECHO_OTP=true` ุงุณุชูุงุฏู ฺฉูุฏ
2. ฺฉุฏ ุฏุฑ console ู ูพุงุณุฎ API ูโุจูุฏ
3. ูุงุฒ ุจู KYC ฺฉุงููโูฺฏุงุฑ ูุณุช

### ๐ก ุจุฑุง Staging/Testing:
1. ุงุฒ `SMS_FALLBACK_TO_ECHO=true` ุงุณุชูุงุฏู ฺฉูุฏ
2. ุงฺฏุฑ ุฎุทุง 501 ุขูุฏุ ุจู Echo ุจุฑูโฺฏุฑุฏุฏ
3. ูโุชูุงูุฏ ุจุง API Key ูุญุฏูุฏ ุชุณุช ฺฉูุฏ

---

## ๐ฏ ฺฺฉโูุณุช Deploy ุจู Production

ูุจู ุงุฒ deploy:

- [ ] `TEST_ECHO_OTP=false` ุชูุธู ุดุฏู
- [ ] `SMS_MOCK_MODE=false` ุชูุธู ุดุฏู
- [ ] `SMS_FALLBACK_TO_ECHO=false` ุชูุธู ุดุฏู
- [ ] `KAVENEGAR_API_KEY` ูุนุชุจุฑ ู ุงุญุฑุงุฒ ููุช ุดุฏู
- [ ] Template `signup` ุฏุฑ ูพูู ุณุงุฎุชู ู ุชุงุฏ ุดุฏู
- [ ] ุญุณุงุจ ฺฉุงููโูฺฏุงุฑ ุดุงุฑฺ ุดุฏู
- [ ] ุชุณุช ููุง ุฑู Staging ุงูุฌุงู ุดุฏู

---

## ๐ ูพุดุชุจุงู

### ฺฉุงููโูฺฏุงุฑ:
- ุชููู: ฐฒฑ-นฑฐฐณนฐฐ
- ูุจโุณุงุช: https://kavenegar.com
- ูพูู: https://panel.kavenegar.com

### ูุงฺฏโูุง:
```bash
# ุฏุฑ Liara
liara logs --app your-app-name

# ุฏุฑ ูุญู
# ุจุฑุฑุณ console ุณุฑูุฑ
```

---

## โ ุฎูุงุตู

**ุงูุงู ฺู ฺฉุงุฑ ุจุงุฏ ุจฺฉูุฏ:**

1. **ุจุฑุง ุชุณุช ููุฑ:**
   ```env
   TEST_ECHO_OTP=true
   SMS_FALLBACK_TO_ECHO=true
   ```
   
2. **ุฏุฑ Liara ุชูุธู ฺฉูุฏ** (Environment Variables)

3. **ุฏุฑุฎูุงุณุช OTP ุจุฒูุฏ** - ฺฉุฏ ุฏุฑ ูุงฺฏ ู ูพุงุณุฎ API ููุงุด ุฏุงุฏู ูโุดูุฏ

4. **ูพุณ ุงุฒ ุชุณุช ูููู:**
   - Template ุฑุง ุฏุฑ ูพูู ฺฉุงููโูฺฏุงุฑ ุจุณุงุฒุฏ
   - ุญุณุงุจ ุฑุง ุงุญุฑุงุฒ ููุช ฺฉูุฏ
   - ูุชุบุฑูุง ุชุณุช ุฑุง ุฎุงููุด ฺฉูุฏ

**ููู ฺุฒ ุขูุงุฏู ุงุณุช!** ๐

